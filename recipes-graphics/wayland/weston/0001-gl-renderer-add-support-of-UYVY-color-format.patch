From 982cde37f1e63e6e18422e785a5c203e2cdd1e53 Mon Sep 17 00:00:00 2001
From: Mustapha Ghanmi <mustapha.ghanmi@st.com>
Date: Tue, 31 Jul 2018 14:21:02 +0200
Subject: [PATCH] gl-renderer: add support of UYVY color format

Signed-off-by: Mustapha Ghanmi <mustapha.ghanmi@st.com>
---
 libweston/gl-renderer.c  | 18 ++++++++++++++++++
 libweston/linux-dmabuf.c |  1 +
 2 files changed, 19 insertions(+)

diff --git a/libweston/gl-renderer.c b/libweston/gl-renderer.c
index 0986761..8bcbc0f 100644
--- a/libweston/gl-renderer.c
+++ b/libweston/gl-renderer.c
@@ -1573,6 +1573,7 @@ gl_renderer_attach_shm(struct weston_surface *es, struct weston_buffer *buffer,
 		}
 		break;
 	case WL_SHM_FORMAT_YUYV:
+	case WL_SHM_FORMAT_UYVY:
 		gs->shader = &gr->texture_shader_y_xuxv;
 		pitch = wl_shm_buffer_get_stride(shm_buffer) / 2;
 		gl_pixel_type = GL_UNSIGNED_BYTE;
@@ -1800,6 +1801,22 @@ struct yuv_format_descriptor yuv_formats[] = {
 			.plane_index = 0
 		}}
 	}, {
+		.format = DRM_FORMAT_UYVY,
+		.input_planes = 1,
+		.output_planes = 2,
+		.texture_type = EGL_TEXTURE_Y_XUXV_WL,
+		{{
+			.width_divisor = 1,
+			.height_divisor = 1,
+			.format = DRM_FORMAT_GR88,
+			.plane_index = 0
+		}, {
+			.width_divisor = 2,
+			.height_divisor = 1,
+			.format = DRM_FORMAT_ARGB8888,
+			.plane_index = 0
+		}}
+	}, {
 		.format = DRM_FORMAT_NV12,
 		.input_planes = 2,
 		.output_planes = 2,
@@ -3315,6 +3332,7 @@ gl_renderer_display_create(struct weston_compositor *ec, EGLenum platform,
 	wl_display_add_shm_format(ec->wl_display, WL_SHM_FORMAT_YUV420);
 	wl_display_add_shm_format(ec->wl_display, WL_SHM_FORMAT_NV12);
 	wl_display_add_shm_format(ec->wl_display, WL_SHM_FORMAT_YUYV);
+	wl_display_add_shm_format(ec->wl_display, WL_SHM_FORMAT_UYVY);
 
 	wl_signal_init(&gr->destroy_signal);
 
diff --git a/libweston/linux-dmabuf.c b/libweston/linux-dmabuf.c
index 5157273..80a01c5 100644
--- a/libweston/linux-dmabuf.c
+++ b/libweston/linux-dmabuf.c
@@ -41,6 +41,7 @@ uint32_t dmabuf_formats[] = {
 	DRM_FORMAT_XRGB8888,
 	DRM_FORMAT_RGB565,
 	DRM_FORMAT_YUYV,
+	DRM_FORMAT_UYVY,
 	DRM_FORMAT_NV12,
 	DRM_FORMAT_YUV420,
 	DRM_FORMAT_YUV444,
-- 
2.7.4

